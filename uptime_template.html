<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>SaaS Accounts Application Uptime Report</title>

  <style>
    body {
      margin: 0;
      padding: 0;
      background: #f4f6f8;
      font-family: Segoe UI, Arial, sans-serif;
      font-size: 13px;
      color: #1f2937;
    }

    .container { width: 100%; background: #ffffff; }
    .section { padding: 12px 18px; }

    .header {
      background: #e01e7e;
      color: #ffffff;
      padding: 16px 20px;
    }

    .header-title { font-size: 18px; font-weight: 600; }
    .header-subtitle { font-size: 13px; opacity: 0.9; }

    .kpi {
      background: #f9fafb;
      border-radius: 8px;
      padding: 10px;
    }

    .kpi-value { font-size: 17px; font-weight: 700; }

    .green { color: #16a34a; }
    .red { color: #dc2626; }
    .orange { color: #f59e0b; }
    .purple { color: #7c3aed; }

    .section-header {
      margin: 14px 0 8px;
      padding-left: 8px;
      border-left: 4px solid #e01e7e;
      font-weight: 600;
    }

    .footer {
      border-top: 1px solid #e5e7eb;
      padding: 14px 18px;
      font-size: 12px;
    }
  </style>
</head>

<body>
<table width="100%" cellpadding="0" cellspacing="0">
<tr>
<td align="center">

<table class="container" width="100%">

<!-- ================= HEADER ================= -->
<tr>
<td class="header">
  <div class="header-title">SaaS Accounts Application Uptime Report</div>
  <div class="header-subtitle">
    Weekly & Quarterly Application Availability Summary
  </div>
</td>
</tr>

<!-- ================= KPI ================= -->
<tr>
<td class="section">
<table width="100%" cellspacing="8">
<tr>

  <td class="kpi" title="Weekly Uptime Avg of all accounts">
    <div class="kpi-value green">‚úî {{ overall_uptime }}</div>
    Overall Uptime Avg
  </td>

  <td class="kpi" title="Total Weekly outages">
    <div class="kpi-value red">‚ö† {{ outage_count }}</div>
    Outages
  </td>

  <td class="kpi"
      title="
{% if affected_accounts %}
Total Affected Accounts: {{ affected_accounts | length }}
Accounts: {{ affected_accounts | join(', ') }}
{% else %}
No accounts affected
{% endif %}
">
    <div class="kpi-value purple">
      üö© {{ major_incident.account or 'N/A' }}
    </div>
    Most Affected Account
  </td>

  <td class="kpi" title="Outage downtime for the most affected account">
    <div class="kpi-value orange">‚è± {{ total_downtime }} mins</div>
    Outage Downtime
  </td>

</tr>
</table>
</td>
</tr>

<!-- ================= WEEKLY GRAPH + OUTAGES ================= -->
<tr>
<td class="section">
<div class="section-header">Weekly Uptime by Account</div>

<table width="100%">
<tr>

<td width="70%" valign="top">
  <img src="data:image/png;base64,{{ weekly_bar }}"
       width="100%"
       style="max-width:700px;display:block;">
</td>

<td width="30%" valign="top">

<!-- üî¥ OUTAGES BOARD (IMAGE MATCHED UI) -->
<div style="
  background:#ffffff;
  border-left:4px solid #dc2626;
  padding:10px 14px;
  border-radius:6px;
  box-shadow:0 4px 10px rgba(0,0,0,.12);
  width:90%;
  text-align:left;
">

  <div style="font-weight:700;color:#111827;margin-bottom:6px;">
    Outages
  </div>

  <hr style="border:none;border-top:1px solid #e5e7eb;margin:6px 0;">

  {% if weekly_outages %}
    {% for o in weekly_outages %}
      <div style="display:flex;justify-content:space-between;
                  font-weight:600;font-size:12px;margin:4px 0;">
        <span>{{ o.account }}</span>
        <span style="color:#dc2626;">{{ o.mins }} mins</span>
      </div>
    {% endfor %}
  {% else %}
    <div style="color:#16a34a;font-weight:600;font-size:12px;">
      ‚úî No Outages
    </div>
  {% endif %}
</div>

</td>
</tr>
</table>
</td>
</tr>

<!-- ================= WEEKLY TABLE ================= -->
<tr>
<td class="section">
  <div class="section-header">{{ weekly_title }}</div>
  {{ weekly_table | safe }}
</td>
</tr>

<!-- ================= QUARTERLY GRAPH + OUTAGES ================= -->
{% if quarterly_bar %}
<tr>
<td class="section">
<div class="section-header">Quarterly YTD Uptime by Account</div>

<table width="100%">
<tr>

<td width="70%" valign="top">
  <img src="data:image/png;base64,{{ quarterly_bar }}"
       width="100%"
       style="max-width:700px;display:block;">
</td>

<td width="30%" valign="top">

<!-- üî¥ OUTAGES BOARD (SAME UI) -->
<div style="
  background:#ffffff;
  border-left:4px solid #dc2626;
  padding:10px 14px;
  border-radius:6px;
  box-shadow:0 4px 10px rgba(0,0,0,.12);
  width:90%;
  text-align:left;
">

  <div style="font-weight:700;color:#111827;margin-bottom:6px;">
    Outages
  </div>

  <hr style="border:none;border-top:1px solid #e5e7eb;margin:6px 0;">

  {% if quarterly_outages %}
    {% for o in quarterly_outages %}
      <div style="display:flex;justify-content:space-between;
                  font-weight:600;font-size:12px;margin:4px 0;">
        <span>{{ o.account }}</span>
        <span style="color:#dc2626;">{{ o.mins }} mins</span>
      </div>
    {% endfor %}
  {% else %}
    <div style="color:#16a34a;font-weight:600;font-size:12px;">
      ‚úî No Outages
    </div>
  {% endif %}
</div>

</td>
</tr>
</table>
</td>
</tr>
{% endif %}

<!-- ================= QUARTERLY TABLE ================= -->
{% if quarterly_table %}
<tr>
<td class="section">
  <div class="section-header">{{ quarterly_title }}</div>
  {{ quarterly_table | safe }}
</td>
</tr>
{% endif %}

<!-- ================= FOOTER ================= -->
<tr>
<td class="footer">
  For any concern over above statistics contact,
  <a href="mailto:incident@businessnext.com">incident@businessnext.com</a><br><br>

  Best Regards,<br>
  Atin Gambhir | Manager ‚Äì ITSM (CDG)<br>

  <img src="cid:businessnext_logo" width="90" style="margin-top:6px"><br>
  www.businessnext.com<br>

  <b style="color:#e01e7e;">#UpForTomorrow</b>
</td>
</tr>

</table>
</td>
</tr>
</table>
</body>
</html>
